<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Beta Garant</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Шрифты: Техно + Читабельность */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Inter:wght@300;400;600&display=swap');
        
        :root {
            /* Palette: Dark Steel & Royal Gold */
            --bg-void: #020408;
            --bg-metal: #0f172a;
            --bg-card: linear-gradient(145deg, #162032 0%, #0a0f18 100%);
            
            --gold-primary: #FFD700;
            --gold-gradient: linear-gradient(135deg, #C59D5F 0%, #FFD700 50%, #C59D5F 100%);
            --steel-gradient: linear-gradient(180deg, #475569 0%, #1e293b 100%);
            
            --accent-blue: #3b82f6;
            --text-main: #F1F5F9;
            --text-gold: #FFD700;
        }

        body {
            background-color: var(--bg-void);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            background-image: 
                radial-gradient(circle at 50% -20%, #1e3a8a33 0%, transparent 60%),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%231e293b' fill-opacity='0.15'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* Typography */
        .font-brand { font-family: 'Orbitron', sans-serif; letter-spacing: 0.05em; text-transform: uppercase; }

        /* Components */
        .card-metallic {
            background: var(--bg-card);
            border: 1px solid #334155;
            box-shadow: 
                inset 1px 1px 0 rgba(255,255,255,0.05),
                0 10px 30px -10px rgba(0,0,0,0.8);
            position: relative;
            overflow: hidden;
        }
        .card-metallic::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, #64748b, transparent); opacity: 0.5;
        }

        .text-gold-gradient {
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(197, 157, 95, 0.3);
        }

        .btn-gold {
            background: var(--gold-gradient);
            color: #0F0F0F;
            font-weight: 800;
            font-family: 'Orbitron', sans-serif;
            border: 1px solid #FCD34D;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
            transition: all 0.2s;
        }
        .btn-gold:active { transform: scale(0.96); box-shadow: 0 0 10px rgba(255, 215, 0, 0.1); }

        .nav-icon.active { color: var(--gold-primary); filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6)); }
        
        /* Utils */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom Inputs */
        .input-metal {
            background: #0b1120;
            border: 1px solid #334155;
            color: white;
            transition: 0.3s;
            font-family: 'Inter', sans-serif;
        }
        .input-metal:focus { border-color: var(--gold-primary); outline: none; box-shadow: 0 0 15px rgba(255, 215, 0, 0.1); }
    </style>
</head>
<body class="h-screen flex flex-col pb-20">

    <!-- HEADER -->
    <header class="h-16 px-5 flex justify-between items-center bg-[#020408]/90 backdrop-blur-md border-b border-[#1e293b] sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 flex items-center justify-center relative">
                <div class="absolute inset-0 bg-blue-900 blur-lg opacity-40"></div>
                <i class="fa-solid fa-shield-halved text-2xl text-gold-gradient" style="color: #FFD700;"></i>
            </div>
            <div>
                <h1 class="font-brand font-bold text-lg text-white leading-none">BETA<span class="text-gold-gradient">GARANT</span></h1>
                <div class="flex items-center gap-1 opacity-60">
                    <div class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-[8px] uppercase tracking-widest">System Online</span>
                </div>
            </div>
        </div>
        
        <!-- Mini Balance -->
        <div onclick="switchTab('stars')" class="flex items-center gap-2 bg-[#0f172a] border border-[#334155] px-3 py-1.5 rounded-lg active:scale-95 transition">
            <i class="fa-solid fa-wallet text-gray-400 text-xs"></i>
            <span class="font-bold text-sm text-white" id="header-balance">0 $</span>
        </div>
    </header>

    <!-- CONTENT -->
    <main class="flex-1 overflow-y-auto p-4 space-y-6" id="main-scroll">

        <!-- DASHBOARD VIEW -->
        <div id="view-dashboard" class="fade-in">
            <!-- Hero Balance Card -->
            <div class="card-metallic rounded-2xl p-6 relative group">
                <div class="absolute top-0 right-0 w-32 h-32 bg-blue-600/10 blur-[50px] rounded-full group-hover:bg-[#FFD700]/10 transition duration-700"></div>
                
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <p class="text-[10px] text-gray-500 font-brand mb-1">Total Assets</p>
                        <h2 class="text-4xl font-bold font-brand text-white tracking-wider flex items-baseline gap-1">
                            <span id="dash-balance">0.00</span> <span class="text-gold-gradient text-2xl">$</span>
                        </h2>
                        <p class="text-xs text-gray-600 mt-1">≈ <span id="dash-rub">0</span> RUB</p>
                    </div>
                    <button onclick="tg.sendData(JSON.stringify({action: 'refresh'}))" class="w-8 h-8 rounded-full bg-[#1e293b] flex items-center justify-center border border-[#334155] active:rotate-180 transition">
                        <i class="fa-solid fa-rotate text-gray-400 text-xs"></i>
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <button onclick="tg.sendData(JSON.stringify({action: 'deposit_menu'}))" class="btn-gold py-3.5 rounded-xl text-xs flex items-center justify-center gap-2 uppercase tracking-wide">
                        <i class="fa-solid fa-arrow-down"></i> Пополнить
                    </button>
                    <button onclick="tg.sendData(JSON.stringify({action: 'withdraw_menu'}))" class="py-3.5 rounded-xl bg-[#0f172a] border border-[#334155] text-white text-xs font-bold uppercase flex items-center justify-center gap-2 active:bg-[#1e293b] transition">
                        <i class="fa-solid fa-arrow-up"></i> Вывести
                    </button>
                </div>
            </div>

            <!-- Quick Access -->
            <div class="grid grid-cols-2 gap-3">
                <div onclick="switchTab('create')" class="card-metallic p-4 rounded-xl flex flex-col items-center justify-center gap-2 active:border-[#FFD700] transition duration-300 group cursor-pointer">
                    <div class="w-10 h-10 rounded-full bg-[#1e293b] flex items-center justify-center group-hover:bg-[#FFD700]/10 transition">
                        <i class="fa-solid fa-hand-holding-dollar text-gray-400 group-hover:text-[#FFD700] text-lg"></i>
                    </div>
                    <span class="text-xs font-bold uppercase text-gray-300">Создать сделку</span>
                </div>
                <div onclick="switchTab('market')" class="card-metallic p-4 rounded-xl flex flex-col items-center justify-center gap-2 active:border-blue-500 transition duration-300 group cursor-pointer">
                    <div class="w-10 h-10 rounded-full bg-[#1e293b] flex items-center justify-center group-hover:bg-blue-500/10 transition">
                        <i class="fa-solid fa-shop text-gray-400 group-hover:text-blue-500 text-lg"></i>
                    </div>
                    <span class="text-xs font-bold uppercase text-gray-300">P2P Маркет</span>
                </div>
            </div>

            <!-- Stats/Deals Strip -->
            <div>
                <div class="flex justify-between items-end mb-3 px-1">
                    <h3 class="font-brand text-xs text-gray-500">Активность</h3>
                    <span class="text-[10px] text-blue-500 bg-blue-500/10 px-2 py-0.5 rounded border border-blue-500/20">Online</span>
                </div>
                <div id="active-deals-list" class="space-y-2">
                    <!-- Заглушка, если пусто -->
                    <div class="text-center py-6 border border-dashed border-[#334155] rounded-xl opacity-40">
                        <i class="fa-solid fa-ghost text-2xl mb-2"></i>
                        <p class="text-[10px] uppercase">Сделок нет</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- CREATE DEAL VIEW -->
        <div id="view-create" class="hidden fade-in">
            <h2 class="font-brand text-xl font-bold mb-4 flex items-center gap-2 text-white">
                <i class="fa-solid fa-pen-nib text-[#FFD700]"></i> Новая сделка
            </h2>
            
            <div class="card-metallic p-5 rounded-xl space-y-5">
                <!-- Role Switcher -->
                <div class="flex bg-[#020408] p-1 rounded-lg border border-[#334155]">
                    <button onclick="setRole('seller')" id="role-s" class="flex-1 py-3 text-xs font-bold uppercase rounded-md bg-[#1e293b] text-white shadow transition">Продавец</button>
                    <button onclick="setRole('buyer')" id="role-b" class="flex-1 py-3 text-xs font-bold uppercase rounded-md text-gray-500 transition">Покупатель</button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="text-[9px] text-gray-500 font-brand mb-1 block">Что продаем/покупаем?</label>
                        <input type="text" id="deal-title" class="input-metal w-full rounded-lg p-3.5 text-sm" placeholder="Название товара или услуги">
                    </div>
                    
                    <div class="flex gap-3">
                        <div class="flex-1">
                            <label class="text-[9px] text-gray-500 font-brand mb-1 block">Сумма</label>
                            <input type="number" id="deal-amount" class="input-metal w-full rounded-lg p-3.5 text-sm font-mono" placeholder="0.00">
                        </div>
                        <div class="w-1/3">
                            <label class="text-[9px] text-gray-500 font-brand mb-1 block">Валюта</label>
                            <select id="deal-curr" class="input-metal w-full rounded-lg p-3.5 text-sm font-bold">
                                <option value="USD">USDT</option>
                                <option value="TON">TON</option>
                                <option value="STARS">★</option>
                                <option value="RUB">RUB</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                         <label class="text-[9px] text-gray-500 font-brand mb-2 block">Платит комиссию (5%)</label>
                         <div class="grid grid-cols-3 gap-2">
                             <button onclick="setFee('buyer')" id="fee-buyer" class="py-2.5 border border-[#334155] bg-[#0b1120] text-[10px] text-gray-400 font-bold rounded-lg uppercase transition">Buyer</button>
                             <button onclick="setFee('seller')" id="fee-seller" class="py-2.5 border border-[#334155] bg-[#0b1120] text-[10px] text-gray-400 font-bold rounded-lg uppercase transition">Seller</button>
                             <button onclick="setFee('5050')" id="fee-5050" class="py-2.5 border border-[#FFD700] bg-[#FFD700]/10 text-[#FFD700] font-bold rounded-lg text-[10px] uppercase transition shadow-sm">50/50</button>
                         </div>
                    </div>
                    
                    <div class="flex items-center gap-2 pt-2">
                         <input type="checkbox" id="is-public" class="w-4 h-4 rounded bg-[#0b1120] border-[#334155] accent-[#FFD700]">
                         <label for="is-public" class="text-xs text-gray-400">Опубликовать в Маркете</label>
                    </div>
                </div>

                <button onclick="createDeal()" class="btn-gold w-full py-4 rounded-xl mt-4 text-sm tracking-widest uppercase shadow-lg">
                    Создать ссылку
                </button>
            </div>
        </div>

        <!-- MARKET VIEW -->
        <div id="view-market" class="hidden fade-in">
            <h2 class="font-brand text-xl font-bold mb-4">P2P Маркет</h2>
            
            <div class="flex gap-2 mb-4 overflow-x-auto no-scrollbar pb-1">
                <button class="px-5 py-2 rounded-lg bg-gradient-to-r from-[#C59D5F] to-[#FFD700] text-black text-xs font-bold uppercase border border-[#FFD700]">Все</button>
                <button class="px-5 py-2 rounded-lg bg-[#1e293b] text-gray-400 text-xs font-bold uppercase border border-[#334155]">Аккаунты</button>
                <button class="px-5 py-2 rounded-lg bg-[#1e293b] text-gray-400 text-xs font-bold uppercase border border-[#334155]">Валюта</button>
            </div>
            
            <div id="market-grid" class="grid grid-cols-2 gap-3 pb-20">
                <!-- Items injected here by JS -->
                <!-- Example Static Item -->
                <div class="card-metallic p-2 rounded-xl group active:scale-[0.98] transition">
                    <div class="h-28 bg-[#020408] rounded-lg mb-2 relative flex items-center justify-center overflow-hidden border border-[#1e293b]">
                        <i class="fa-solid fa-gift text-4xl text-pink-500 opacity-70 group-hover:scale-110 transition duration-500"></i>
                        <div class="absolute top-1 right-1 bg-black/80 px-1.5 py-0.5 rounded border border-[#FFD700]/30"><span class="text-[8px] text-[#FFD700] font-bold uppercase">HOT</span></div>
                    </div>
                    <div class="px-1">
                        <h4 class="text-xs font-bold text-white uppercase truncate">Telegram Premium</h4>
                        <div class="flex justify-between items-center border-t border-[#334155] pt-2 mt-2">
                            <span class="text-xs font-bold text-[#FFD700] font-mono">300 ₽</span>
                            <button onclick="tg.sendData(JSON.stringify({action: 'buy_market', id: 'static'}))" class="w-6 h-6 rounded bg-[#334155] text-white flex items-center justify-center hover:bg-[#FFD700] hover:text-black transition"><i class="fa-solid fa-plus text-[10px]"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PROFILE VIEW -->
        <div id="view-profile" class="hidden fade-in">
            <div class="flex flex-col items-center mb-6">
                <div class="w-24 h-24 rounded-full p-0.5 bg-gradient-to-b from-[#FFD700] to-[#855a15] relative mb-3 shadow-[0_0_25px_rgba(255,215,0,0.15)]">
                    <img id="profile-avatar" src="" class="w-full h-full rounded-full bg-[#020408]">
                    <div class="absolute -bottom-1 bg-[#1e293b] border border-[#FFD700] px-3 py-0.5 rounded-full text-[9px] text-[#FFD700] font-bold uppercase">
                        Titanium
                    </div>
                </div>
                <h2 class="font-brand text-lg font-bold text-white" id="profile-name">User Name</h2>
                <p class="text-xs text-gray-500 font-mono">ID: <span id="profile-id">000000</span></p>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-3 gap-2 mb-6">
                <div class="card-metallic p-3 text-center rounded-xl">
                    <p class="text-[9px] text-gray-500 uppercase font-bold">Сделок</p>
                    <p class="text-base font-bold text-white">0</p>
                </div>
                <div class="card-metallic p-3 text-center rounded-xl border-b-2 border-green-500">
                    <p class="text-[9px] text-gray-500 uppercase font-bold">Trust</p>
                    <p class="text-base font-bold text-green-500">100%</p>
                </div>
                <div class="card-metallic p-3 text-center rounded-xl">
                    <p class="text-[9px] text-gray-500 uppercase font-bold">Рефералы</p>
                    <p class="text-base font-bold text-[#FFD700]">0</p>
                </div>
            </div>

            <!-- Referral Card -->
            <div class="card-metallic p-5 rounded-xl mb-4 relative overflow-hidden">
                <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
                <div class="relative z-10">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-brand text-sm font-bold text-white">Реферальная сеть</h3>
                        <i class="fa-solid fa-users-rays text-[#FFD700]"></i>
                    </div>
                    <p class="text-[10px] text-gray-400 mb-4 w-3/4">Получай <span class="text-white font-bold">20%</span> с комиссии каждой сделки приглашенного друга.</p>
                    
                    <div class="flex gap-2">
                        <input type="text" id="ref-link" class="w-full bg-[#020408] border border-[#334155] rounded-lg px-3 py-2 text-xs text-gray-400 font-mono" readonly>
                        <button onclick="copyRef()" class="px-4 bg-[#334155] rounded-lg text-white hover:bg-[#FFD700] hover:text-black transition"><i class="fa-regular fa-copy"></i></button>
                    </div>
                </div>
            </div>
            
            <!-- Stars Shop (Account) -->
            <button onclick="tg.sendData(JSON.stringify({action: 'stars_shop'}))" class="w-full card-metallic p-4 rounded-xl flex items-center justify-between group active:bg-[#1e293b]">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-yellow-500/10 flex items-center justify-center"><i class="fa-solid fa-star text-yellow-500"></i></div>
                    <span class="text-xs font-bold text-gray-300 uppercase">Магазин Звезд (На аккаунт)</span>
                </div>
                <i class="fa-solid fa-chevron-right text-xs text-gray-600"></i>
            </button>
        </div>

    </main>

    <!-- NAV BAR -->
    <nav class="h-16 bg-[#020408]/95 backdrop-blur-md border-t border-[#1e293b] fixed bottom-0 w-full z-50 flex justify-around items-center px-2 pb-2">
        <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-icon active flex flex-col items-center gap-1 w-14 transition text-[#FFD700]">
            <i class="fa-solid fa-chart-pie text-lg"></i>
            <span class="text-[9px] font-bold uppercase tracking-widest">Home</span>
        </button>
        <button onclick="switchTab('market')" id="nav-market" class="nav-icon flex flex-col items-center gap-1 w-14 transition text-gray-500">
            <i class="fa-solid fa-shop text-lg"></i>
            <span class="text-[9px] font-bold uppercase tracking-widest">Market</span>
        </button>
        
        <button onclick="switchTab('create')" class="w-16 h-16 -mt-8 rounded-full bg-gradient-to-t from-[#B45309] to-[#FFD700] border-4 border-[#020408] flex items-center justify-center shadow-[0_0_20px_rgba(255,215,0,0.3)] active:scale-95 transition">
            <i class="fa-solid fa-plus text-xl text-[#0F0F0F]"></i>
        </button>

        <button onclick="switchTab('profile')" id="nav-profile" class="nav-icon flex flex-col items-center gap-1 w-14 transition text-gray-500">
            <i class="fa-solid fa-user-shield text-lg"></i>
            <span class="text-[9px] font-bold uppercase tracking-widest">Profile</span>
        </button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor('#020408');
        tg.setBackgroundColor('#020408');

        // Initial Logic
        const user = tg.initDataUnsafe.user || {id: 123456, first_name: 'BetaUser'};
        document.getElementById('profile-name').innerText = user.first_name;
        document.getElementById('profile-id').innerText = user.id;
        document.getElementById('ref-link').value = `https://t.me/BetaGarant_bot?start=ref_${user.id}`;
        
        const avatar = document.getElementById('profile-avatar');
        if(user.photo_url) avatar.src = user.photo_url;
        else avatar.src = `https://ui-avatars.com/api/?name=${user.first_name}&background=0f172a&color=FFD700&bold=true`;

        // State
        let role = 'seller';
        let fee = '5050';

        function switchTab(id) {
            tg.HapticFeedback.impactOccurred('light');
            ['dashboard', 'create', 'market', 'profile'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                const nav = document.getElementById(`nav-${v}`);
                if(nav) { nav.classList.remove('active', 'text-[#FFD700]'); nav.classList.add('text-gray-500'); }
            });
            document.getElementById(`view-${id}`).classList.remove('hidden');
            document.getElementById(`view-${id}`).classList.remove('fade-in');
            void document.getElementById(`view-${id}`).offsetWidth;
            document.getElementById(`view-${id}`).classList.add('fade-in');

            const nav = document.getElementById(`nav-${id}`);
            if(nav) { nav.classList.add('active', 'text-[#FFD700]'); nav.classList.remove('text-gray-500'); }
        }

        function setRole(r) {
            role = r;
            const s = document.getElementById('role-s');
            const b = document.getElementById('role-b');
            const active = "flex-1 py-3 text-xs font-bold uppercase rounded-md bg-[#1e293b] text-white shadow transition";
            const inactive = "flex-1 py-3 text-xs font-bold uppercase rounded-md text-gray-500 transition";
            if(r==='seller') { s.className=active; b.className=inactive; } else { b.className=active; s.className=inactive; }
        }

        function setFee(f) {
            fee = f;
            document.querySelectorAll('#fee-buyer, #fee-seller, #fee-5050').forEach(el => {
                el.className = "py-2.5 border border-[#334155] bg-[#0b1120] text-[10px] text-gray-400 font-bold rounded-lg uppercase transition";
            });
            document.getElementById(`fee-${f}`).className = "py-2.5 border border-[#FFD700] bg-[#FFD700]/10 text-[#FFD700] font-bold rounded-lg text-[10px] uppercase transition shadow-sm";
        }

        function createDeal() {
            const t = document.getElementById('deal-title').value;
            const a = document.getElementById('deal-amount').value;
            const c = document.getElementById('deal-curr').value;
            const pub = document.getElementById('is-public').checked;

            if(!t || !a) return tg.showAlert("Заполните все поля");
            
            tg.sendData(JSON.stringify({
                action: 'create_deal',
                title: t, amount: a, currency: c, role: role, fee: fee, public: pub
            }));
        }

        function copyRef() {
            const el = document.getElementById('ref-link');
            el.select();
            document.execCommand('copy');
            tg.showAlert("Ссылка скопирована!");
        }

        // Listen to events from bot (optional, for advanced balance updates)
        // For now, we assume simple flow.
    </script>
</body>
</html>


