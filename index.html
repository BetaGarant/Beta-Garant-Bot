<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Beta Garant</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Inter:wght@400;500;600&display=swap');
        
        :root {
            --bg-deep: #05090e;
            --gold-primary: #d4af37;
            --gold-gradient: linear-gradient(135deg, #fcd34d 0%, #b45309 100%);
            --steel-border: #334155;
        }

        body {
            background-color: var(--bg-deep);
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #05090e 70%);
            background-attachment: fixed;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .font-tech { font-family: 'Rajdhani', sans-serif; text-transform: uppercase; letter-spacing: 0.05em; }

        .card-titanium {
            background: linear-gradient(160deg, #162030 0%, #05090e 100%);
            border: 1px solid #1e293b;
            box-shadow: inset 1px 1px 0 rgba(255,255,255,0.05), 0 4px 20px rgba(0,0,0,0.5);
        }

        .btn-gold {
            background: var(--gold-gradient);
            color: #000;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(217, 119, 6, 0.3);
        }

        .nav-item.active { color: #d4af37; }
        .hidden { display: none; }
        
        /* Анимации */
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="h-screen flex flex-col pb-20">

    <!-- HEADER -->
    <header class="h-14 px-4 flex justify-between items-center bg-[#05090e]/90 backdrop-blur border-b border-[#1e293b] sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <i class="fa-solid fa-shield-halved text-[#d4af37]"></i>
            <span class="font-tech font-bold text-lg text-white tracking-widest">BETA<span class="text-[#d4af37]">GARANT</span></span>
        </div>
        <div class="flex items-center gap-2 bg-[#1e293b] px-3 py-1 rounded border border-[#334155]">
            <i class="fa-solid fa-star text-[#d4af37] text-xs"></i>
            <span class="font-bold text-xs" id="balance-display">0.00</span>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto p-4 space-y-4" id="main-scroll">
        
        <!-- DASHBOARD -->
        <div id="view-home" class="fade-in">
            <!-- Balance Card -->
            <div class="card-titanium rounded-xl p-5 relative overflow-hidden mb-4">
                <div class="absolute top-0 right-0 w-24 h-24 bg-[#d4af37]/10 blur-[40px] rounded-full"></div>
                <p class="text-[10px] text-gray-500 uppercase font-bold tracking-widest mb-1">Total Balance</p>
                <h2 class="text-3xl font-bold font-tech text-white mb-4" id="main-balance">0 <span class="text-[#d4af37]">★</span></h2>
                
                <div class="flex gap-2">
                    <button onclick="tg.sendData(JSON.stringify({action: 'deposit_req'}))" class="flex-1 py-2 rounded bg-[#334155] text-xs font-bold uppercase border border-white/10 active:bg-[#d4af37] active:text-black transition">Пополнить</button>
                    <button onclick="switchTab('profile')" class="flex-1 py-2 rounded bg-[#334155] text-xs font-bold uppercase border border-white/10 active:bg-[#d4af37] active:text-black transition">Профиль</button>
                </div>
            </div>

            <!-- Active Deals List -->
            <h3 class="font-tech text-xs text-gray-500 font-bold mb-2 uppercase">Мои сделки</h3>
            <div id="deals-container" class="space-y-2">
                <!-- Сделки подгружаются динамически. Если пусто: -->
                <div class="text-center py-8 opacity-30">
                    <i class="fa-solid fa-box-open text-4xl mb-2"></i>
                    <p class="text-xs">Активных сделок нет</p>
                </div>
            </div>
        </div>

        <!-- CREATE DEAL -->
        <div id="view-create" class="hidden fade-in">
            <h2 class="font-tech text-xl font-bold mb-4">Новая сделка</h2>
            <div class="card-titanium p-5 rounded-xl">
                <!-- Role -->
                <div class="flex bg-[#05090e] p-1 rounded mb-4 border border-[#334155]">
                    <button onclick="setRole('seller')" id="role-s" class="flex-1 py-2 text-xs font-bold uppercase rounded bg-[#334155] text-white transition">Продавец</button>
                    <button onclick="setRole('buyer')" id="role-b" class="flex-1 py-2 text-xs font-bold uppercase rounded text-gray-500 transition">Покупатель</button>
                </div>

                <div class="space-y-3">
                    <input type="text" id="deal-title" class="w-full bg-[#05090e] border border-[#334155] rounded p-3 text-sm text-white focus:border-[#d4af37] outline-none" placeholder="Название товара (напр. Аккаунт Steam)">
                    
                    <div class="flex gap-2">
                        <input type="number" id="deal-amount" class="w-full bg-[#05090e] border border-[#334155] rounded p-3 text-sm text-white focus:border-[#d4af37] outline-none font-mono" placeholder="Сумма">
                        <select id="deal-curr" class="bg-[#05090e] border border-[#334155] rounded px-3 text-sm text-white font-bold outline-none">
                            <option value="RUB">RUB</option>
                            <option value="USD">USD</option>
                            <option value="TON">TON</option>
                            <option value="STARS">★</option>
                        </select>
                    </div>

                    <!-- Fee Selection -->
                    <div>
                        <p class="text-[10px] text-gray-500 uppercase font-bold mb-1">Комиссию платит</p>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setFee('buyer')" class="fee-btn py-2 border border-[#334155] rounded bg-[#05090e] text-[10px] text-gray-400 font-bold active-fee" id="fee-buyer">Покупатель</button>
                            <button onclick="setFee('seller')" class="fee-btn py-2 border border-[#334155] rounded bg-[#05090e] text-[10px] text-gray-400 font-bold" id="fee-seller">Продавец</button>
                            <button onclick="setFee('5050')" class="fee-btn py-2 border border-[#334155] rounded bg-[#05090e] text-[10px] text-gray-400 font-bold" id="fee-5050">50 / 50</button>
                        </div>
                    </div>
                </div>

                <button onclick="createDeal()" class="btn-gold w-full py-3 rounded mt-6 text-sm uppercase tracking-widest font-bold">
                    Создать ссылку
                </button>
            </div>
        </div>

        <!-- PROFILE -->
        <div id="view-profile" class="hidden fade-in">
            <div class="flex items-center gap-4 mb-6">
                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-[#d4af37] to-[#855a15] p-0.5">
                    <img id="user-avatar" src="" class="w-full h-full rounded-full bg-[#05090e]">
                </div>
                <div>
                    <h2 class="font-tech text-lg font-bold text-white" id="user-name">User</h2>
                    <p class="text-xs text-gray-500" id="user-id">ID: ...</p>
                </div>
            </div>
            
            <div class="card-titanium p-4 rounded-xl mb-4">
                <h3 class="font-bold text-white text-xs uppercase mb-2">Реферальная ссылка</h3>
                <div class="flex gap-2">
                    <input type="text" id="ref-link" class="w-full bg-[#05090e] border border-[#334155] rounded px-3 py-2 text-xs text-gray-400" readonly>
                    <button onclick="copyRef()" class="px-3 py-2 bg-[#334155] rounded text-white"><i class="fa-regular fa-copy"></i></button>
                </div>
                <p class="text-[10px] text-gray-500 mt-2">Приглашай людей и получай % с их сделок.</p>
            </div>
        </div>

    </main>

    <!-- NAV BAR -->
    <nav class="h-16 bg-[#05090e]/95 backdrop-blur border-t border-[#1e293b] fixed bottom-0 w-full z-50 flex justify-around items-center">
        <button onclick="switchTab('home')" id="nav-home" class="nav-item active flex flex-col items-center gap-1 w-14 transition text-[#d4af37]">
            <i class="fa-solid fa-house"></i>
            <span class="text-[9px] font-bold uppercase">Home</span>
        </button>
        <button onclick="switchTab('create')" class="w-12 h-12 -mt-6 rounded-full bg-gradient-to-br from-[#334155] to-[#0f172a] border border-[#d4af37] flex items-center justify-center shadow-[0_0_15px_rgba(212,175,55,0.2)]">
            <i class="fa-solid fa-plus text-[#d4af37]"></i>
        </button>
        <button onclick="switchTab('profile')" id="nav-profile" class="nav-item flex flex-col items-center gap-1 w-14 transition text-gray-500">
            <i class="fa-solid fa-user"></i>
            <span class="text-[9px] font-bold uppercase">Profile</span>
        </button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor('#05090e');
        
        // Init User
        const user = tg.initDataUnsafe.user || {id: 0, first_name: 'Guest'};
        document.getElementById('user-name').innerText = user.first_name;
        document.getElementById('user-id').innerText = `ID: ${user.id}`;
        document.getElementById('ref-link').value = `https://t.me/BetaGarant_bot?start=ref_${user.id}`;
        if(user.photo_url) document.getElementById('user-avatar').src = user.photo_url;
        else document.getElementById('user-avatar').src = "https://ui-avatars.com/api/?name=" + user.first_name + "&background=random";

        let currentRole = 'seller';
        let currentFee = 'buyer';

        function switchTab(id) {
            tg.HapticFeedback.impactOccurred('light');
            ['home', 'create', 'profile'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                const nav = document.getElementById(`nav-${v}`);
                if(nav) { nav.classList.remove('active', 'text-[#d4af37]'); nav.classList.add('text-gray-500'); }
            });
            document.getElementById(`view-${id}`).classList.remove('hidden');
            const nav = document.getElementById(`nav-${id}`);
            if(nav) { nav.classList.add('active', 'text-[#d4af37]'); nav.classList.remove('text-gray-500'); }
        }

        function setRole(r) {
            currentRole = r;
            const s = document.getElementById('role-s');
            const b = document.getElementById('role-b');
            if(r === 'seller') {
                s.className = "flex-1 py-2 text-xs font-bold uppercase rounded bg-[#334155] text-white transition";
                b.className = "flex-1 py-2 text-xs font-bold uppercase rounded text-gray-500 transition";
            } else {
                b.className = "flex-1 py-2 text-xs font-bold uppercase rounded bg-[#334155] text-white transition";
                s.className = "flex-1 py-2 text-xs font-bold uppercase rounded text-gray-500 transition";
            }
        }

        function setFee(f) {
            currentFee = f;
            document.querySelectorAll('.fee-btn').forEach(b => {
                b.classList.remove('bg-[#d4af37]/10', 'border-[#d4af37]', 'text-[#d4af37]');
                b.classList.add('bg-[#05090e]', 'border-[#334155]', 'text-gray-400');
            });
            const btn = document.getElementById(`fee-${f}`);
            btn.classList.remove('bg-[#05090e]', 'border-[#334155]', 'text-gray-400');
            btn.classList.add('bg-[#d4af37]/10', 'border-[#d4af37]', 'text-[#d4af37]');
        }

        function createDeal() {
            const t = document.getElementById('deal-title').value;
            const a = document.getElementById('deal-amount').value;
            const c = document.getElementById('deal-curr').value;
            
            if(!t || !a) { tg.showAlert("Заполните поля!"); return; }

            tg.sendData(JSON.stringify({
                action: 'create_deal',
                title: t,
                amount: a,
                currency: c,
                role: currentRole,
                fee: currentFee
            }));
        }

        function copyRef() {
            const el = document.getElementById('ref-link');
            el.select();
            document.execCommand('copy'); // For mobile compat
            tg.showAlert("Ссылка скопирована!");
        }
    </script>
</body>
</html>


